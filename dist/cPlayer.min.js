!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cPlayer",[],t):"object"==typeof exports?exports.cPlayer=t():e.cPlayer=t()}(this,function(){return function(e){function t(l){if(n[l])return n[l].exports;var a=n[l]={i:l,l:!1,exports:{}};return e[l].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,l){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:l})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,n,l){return n&&e(t.prototype,n),l&&e(t,l),t}}(),r=function(){function e(t){l(this,e),this.option=t;var n={autoplay:!1,skin:"default",mode:"default",volume:50,playlist:null};for(var a in n)t.hasOwnProperty(a)||(t[a]=n[a]);null!=this.option.element?this.init():console.log("播放器加载失败 (原因: 容器不存在)")}return a(e,[{key:"init",value:function(){var e=this,t=this.option.element.id;this.pFirst=!0,this.currTrack=0;var n=this.jsPath()+"skins/"+this.option.skin+"/";this.xhr(n+"template.html").then(function(l){l=l.replace(new RegExp(/{{ ([^"]*) }}/g),t+"$1"),e.option.element.innerHTML=l;for(var a=document.getElementsByTagName("link"),r=!0,s=0;s<a.length;s++){var i=a[s].rel,o=a[s].href;"stylesheet"==i&&o.match(n+"template.css")&&(r=!1)}if(r){var u=document.getElementsByTagName("body")[0],d=document.createElement("link");d.rel="stylesheet",d.href=n+"template.css",u.appendChild(d)}if(e.elements={root:e.option.element,cover_el:document.getElementById(t+"TrackCover"),title_el:document.getElementById(t+"TrackTitle"),artist_el:document.getElementById(t+"TrackArtist"),track_duration_time:document.getElementById(t+"TrackDurationTime"),track_played_time:document.getElementById(t+"TrackPlayedTime"),seek:document.getElementById(t+"Seek"),seek_played:document.getElementById(t+"SeekPlayed"),seek_played_point:document.getElementById(t+"SeekPlayedPoint"),seek_loaded:document.getElementById(t+"SeekLoaded"),toggle_btn_el:document.getElementById(t+"ToggleBtn"),stop_btn_el:document.getElementById(t+"StopBtn"),prev_btn_el:document.getElementById(t+"PrevBtn"),next_btn_el:document.getElementById(t+"NextBtn"),mode_btn_el:document.getElementById(t+"ModeBtn"),mute_btn_el:document.getElementById(t+"MuteBtn"),volume_bar_el:document.getElementById(t+"VolumeBar"),volume_fill_el:document.getElementById(t+"VolumeFill")},e.player=e.createPlayer(),null!=e.elements.toggle_btn_el&&e.elements.toggle_btn_el.addEventListener("click",function(){e.toggle()}),null!=e.elements.stop_btn_el&&e.elements.stop_btn_el.addEventListener("click",function(){e.stop()}),null!=e.elements.prev_btn_el&&e.elements.prev_btn_el.addEventListener("click",function(){e.prev()}),null!=e.elements.next_btn_el&&e.elements.next_btn_el.addEventListener("click",function(){e.next()}),null!=e.elements.mode_btn_el&&(e.addClass(e.elements.mode_btn_el,e.option.mode),e.elements.mode_btn_el.addEventListener("click",function(){e.modeToggle()})),null!=e.elements.seek){var m=function(t){var n=t||window.event,l=0,a=e.getOffset(e.elements.seek,"left"),r=e.elements.seek.clientWidth;l=parseInt(-(a-n.clientX)/r*100),l<0?l=0:l>100&&(l=100),e.updateBar("played",l),e.seek(l),e.elements.track_played_time.innerHTML=e.timeParse(e.player.currentTime)},c=function t(){document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",t),e.playedInterval=setInterval(function(){var t=e.player.currentTime,n=parseInt(e.player.currentTime/e.player.duration*100);null!=e.elements.track_played_time&&(e.elements.track_played_time.innerHTML=e.timeParse(t)),null!=e.elements.seek&&(isNaN(n)?e.updateBar("played",0):e.updateBar("played",n))},100)};e.elements.seek_played_point.addEventListener("mousedown",function(){clearInterval(e.playedInterval),document.addEventListener("mousemove",m),document.addEventListener("mouseup",c)}),e.elements.seek.addEventListener("click",m)}null!=e.elements.volume_bar_el&&e.elements.volume_bar_el.addEventListener("click",function(t){var n=t||window.event,l=0,a=e.getOffset(e.elements.volume_bar_el,"left"),r=e.elements.volume_bar_el.clientWidth;l=parseInt(-(a-n.clientX)/r*100),l<0?l=0:l>100&&(l=100),e.volume(l)}),null!=e.elements.mute_btn_el&&e.elements.mute_btn_el.addEventListener("click",function(){e.mute()}),"random"==e.option.mode&&(e.genRandomPlaylist(),e.currTrack=e.randomPlaylist[0]),e.option.playlist.length>0&&e.load(e.currTrack)}).catch(function(e){console.log(e)})}},{key:"createPlayer",value:function(){var e=this,t=document.createElement("audio");return t.addEventListener("play",function(){null!=e.elements.toggle_btn_el&&e.addClass(e.elements.toggle_btn_el,"playing")}),t.addEventListener("pause",function(){null!=e.elements.toggle_btn_el&&e.removeClass(e.elements.toggle_btn_el,"playing")}),t.addEventListener("loadstart",function(){null!=e.elements.toggle_btn_el&&e.removeClass(e.elements.toggle_btn_el,"playing"),e.playedInterval=setInterval(function(){var t=e.player.currentTime,n=parseInt(e.player.currentTime/e.player.duration*100);null!=e.elements.track_played_time&&(e.elements.track_played_time.innerHTML=e.timeParse(t)),null!=e.elements.seek&&(isNaN(n)?e.updateBar("played",0):e.updateBar("played",n))},100),e.pFirst&&e.volume(e.option.volume)}),t.addEventListener("loadedmetadata",function(){!e.option.autoplay&&e.pFirst||e.play(),e.pFirst&&(e.pFirst=!1)}),t.addEventListener("progress",function(){var t=e.player.buffered.length?e.player.buffered.end(e.player.buffered.length-1)/e.player.duration*100:0;e.updateBar("loaded",t)}),t.addEventListener("volumechange",function(){e.player.muted?null!=e.elements.mute_btn_el&&e.addClass(e.elements.mute_btn_el,"muted"):null!=e.elements.mute_btn_el&&e.removeClass(e.elements.mute_btn_el,"muted"),null!=e.elements.volume_bar_el&&e.updateBar("volume",100*e.player.volume)}),t.addEventListener("durationchange",function(){null!=e.elements.track_duration_time&&1!=e.player.duration&&(e.elements.track_duration_time.innerHTML=e.timeParse(t.duration))}),t.addEventListener("ended",function(){e.next()}),t}},{key:"load",value:function(e){var t=this.option.playlist[e];t?(this.currTrack=e,null!=this.elements.cover_el&&(this.elements.cover_el.src=t.cover),null!=this.elements.title_el&&(this.elements.title_el.innerHTML=t.title),null!=this.elements.artist_el&&(this.elements.artist_el.innerHTML=t.artist),this.player.src=t.file,clearInterval(this.playedInterval)):console.log("歌曲不存在!")}},{key:"play",value:function(){this.player.play()}},{key:"stop",value:function(){this.player.currentTime=0,this.player.pause(),null!=this.elements.seek&&this.updateBar("played",0),null!=this.elements.track_played_time&&(this.elements.track_played_time.innerHTML=this.timeParse(this.player.currentTime))}},{key:"prev",value:function(){var e=this.currTrack;switch(this.updateBar("played",0),this.pFirst&&(this.pFirst=!1),this.option.mode){case"default":e>0?e--:e=this.option.playlist.length-1;break;case"random":for(var t=0,n=0;n<this.randomPlaylist.length;n++)this.currTrack==this.randomPlaylist[n]&&(t=n);e=t>0?this.randomPlaylist[t-1]:this.randomPlaylist[this.randomPlaylist.length-1]}this.load(e)}},{key:"next",value:function(){var e=this.currTrack;switch(this.updateBar("played",0),this.pFirst&&(this.pFirst=!1),this.option.mode){case"default":e<this.option.playlist.length-1?e++:e=0;break;case"random":for(var t=0,n=0;n<this.randomPlaylist.length;n++)this.currTrack==this.randomPlaylist[n]&&(t=n);e=t<this.randomPlaylist.length-1?this.randomPlaylist[t+1]:this.randomPlaylist[0]}this.load(e)}},{key:"modeToggle",value:function(){for(var e=["default","loop","random"],t=0;t<e.length;t++)this.option.mode==e[t]&&null!=this.elements.mode_btn_el&&this.removeClass(this.elements.mode_btn_el,e[t]);"default"==this.option.mode?this.option.mode="loop":"loop"==this.option.mode?(this.option.mode="random",this.genRandomPlaylist()):this.option.mode="default",null!=this.elements.mode_btn_el&&this.addClass(this.elements.mode_btn_el,this.option.mode)}},{key:"toggle",value:function(){4==this.player.readyState&&(this.player.paused?this.player.play():this.player.pause())}},{key:"seek",value:function(e){var t=this.player.duration*(e/100);isNaN(t)&&(t=0),this.player.currentTime=t}},{key:"mute",value:function(){this.player.muted?this.player.muted=!1:this.player.muted=!0}},{key:"volume",value:function(e){var t=parseInt(e);this.player.volume=t/100,this.player.volume>0?this.player.muted=!1:this.player.muted=!0}},{key:"push",value:function(e){var t=this;e.forEach(function(e){t.option.playlist.push(e),t.genRandomPlaylist()})}},{key:"destroy",value:function(){this.stop(),this.option.element.innerHTML="",clearInterval(this.playedInterval);for(var e in this)this.hasOwnProperty(e)&&delete this[e]}},{key:"genRandomPlaylist",value:function(){this.randomPlaylist=[];for(var e=0;e<this.option.playlist.length;e++)this.randomPlaylist.push(e);this.randomPlaylist.sort(function(){return.5-Math.random()})}},{key:"updateBar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",t=arguments[1];switch(e){case"played":this.elements.seek_played.style.width=t+"%";break;case"loaded":this.elements.seek_loaded.style.width=t+"%";break;case"volume":this.elements.volume_fill_el.style.width=t+"%"}}},{key:"xhr",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(l,a){try{var r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&200==r.status?l(r.responseText):4==r.readyState&&a(r.status)},r.open(t,e,!0),r.send(n)}catch(e){}})}},{key:"jsPath",value:function(){for(var e=document.getElementById("cmScript"),t=e.attributes.src.nodeValue.split("/"),n="",l=0;l<t.length-1;l++)n+=t[l]+"/";return n}},{key:"addClass",value:function(e,t){var n="";n="string"==typeof e?document.getElementById(e):e,n.className.indexOf(t)<0&&(n.className+=" "+t)}},{key:"removeClass",value:function(e,t){var n="";if(n="string"==typeof e?document.getElementById(e):e,n.className.indexOf(t)>0){var l=new RegExp("(\\s|^)"+t+"(\\s|$)");n.className=n.className.replace(l,"")}}},{key:"getOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left",n=0,l=null;switch(t){case"left":n=e.offsetLeft,l=e.offsetParent;break;default:n=e.offsetTop,l=e.offsetParent}for(;null!=l;)n+="left"==t?l.offsetLeft:l.offsetTop,l=l.offsetParent;return n}},{key:"timeParse",value:function(e){var t=0,n=0;return t=parseInt(e/60),n=parseInt(e%60),t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n}}]),e}();e.exports=r}])});